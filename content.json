[{"title":"php浮点数问题","date":"2017-10-07T07:44:58.000Z","path":"2017/10/07/php浮点数问题/","text":"一、两个浮点数运算问题1、小数乘以100 代码： 1234$a = 20.40;echo $a.PHP_EOL;$b = intval($a*100);echo $b.PHP_EOL; 结果： 1220.42039 再看另一段代码： 1234567$a = 20.4;$b = $a * 100; //其实很多小数都有类似问题，也不限于PHPecho (string) $b . PHP_EOL;echo (int) $b .PHP_EOL;echo floor($b) .PHP_EOL;echo ceil($b) . PHP_EOL;echo (int)(string) $b . PHP_EOL; 运行结果： 1234520402039203920402040 2、两个浮点数比较大小 代码： 12345$a = 0.1;$b = 0.9;$c = 1;var_dump(($a+$b)==$c);var_dump(($c-$b)==$a); 运行结果： 12truefalse 看完这两个问题，我相信很多同学会有一种疑问，这个是php的bug吗？且看下面的问题分析 二、问题分析1、浮点数的表示要搞明白这个原因, 首先我们要知道浮点数的表示(IEEE 754): 浮点数, 以64位的长度(双精度)为例, 会采用1位符号位(E), 11指数位(Q), 52位尾数(M)表示(一共64位) 符号位：最高位表示数据的正负，0表示正数，1表示负数。 指数位：表示数据以2为底的幂，指数采用偏移码表示 尾数：表示数据小数点后的有效数字.然后我们需要了解的是浮点数如何转换为二进制数 2、浮现数转二进制方法 整数部分采用除以2取余方法 小数部分采用乘以2取整方法 例如： 把数字8.5转为二进制 整数部分是8 8/2=4 8%2=0 4/2=2 4%2=0 2/2=1 2%2=0 1比2小，因此不需要计算下去，整数8的二进制为 1000 小数部分是0.5 0.5x2 = 1.0 因取整后小数部分为0，因此不需要再计算下去 小数0.5的二进制为 0.1 8.5的二进制为1000.1 3、运算问题1 根据上面关于浮点数表示的解释，20.4转换为二进制64位浮点数为：0100000000110100011001100110011001100110011001100110011001100110,小数部分0.4转换为二进制来说，是无限长的，再乘以100时，截断52位来计算的话就是20.399999999…,再乘以100，int转换为整数，就是2039了 4、运算问题2这个问题中，0.9在转换为二进制时，同样也会有精度丢失的问题 看下面这段代码： 12345$a = 0.1;$b = 0.9;$c = 1;printf(&quot;%.20f&quot;, $a+$b);printf(&quot;%.20f&quot;, $c-$b); 运行结果： 121.000000000000000000000.09999999999999997780 三、综合1、简单乘法 我在开发时，曾经多次遇到小数乘以100，得到错误结果的问题，初步可以转换为string类型解决 2、高精度运算方法 使用高精度的运算方法，这样可以保证精度不丢失。 高精度运算的方法如下： bcadd 将两个高精度数字相加 bccomp 比较两个高精度数字，返回-1,0,1 bcdiv 将两个高精度数字相除 bcmod 求高精度数字余数 bcmul 将两个高精度数字相乘 bcpow 求高精度数字乘方 bcpowmod 求高精度数字乘方求模 bcscale 配置默认小数点位数，相当于Linux bc中的”scale=” csqrt 求高精度数字平方根 bcsub 将两个高精度数字相减 代码：12345$a = 0.1;$b = 0.9;$c = 1;var_dump(($c-$b)==$a);var_dump(bcsub($c, $b, 1)==$a); 运行结果：12falsetrue php计算的问题还有可能和操作系统的位数相关，比如32位和64位，这些大家可以研究下~","tags":[{"name":"php","slug":"php","permalink":"http://yoursite.com/tags/php/"}]},{"title":"序言","date":"2017-10-06T03:53:03.000Z","path":"2017/10/06/随笔/","text":"一、由来1、前世 其实，在一年以前我就已经用hexo加github搭建过个人的博客。去年的时候，偶然看到我一个高中好哥们的博客,他的博客就是用hexo+github搭的，不过那个时候仅仅是想作为一个相册使用，里面放的都是我自己和女朋友的一些照片。后来，懒得去维护了，空间和域名都渐渐荒废了。之前的那个博客可以算的上是这个的前世 2、今生 前段时间申请了自己的一个域名:lili-web.com,想着去阿里云买一台服务器，搭一个自己的技术博客。去阿里云上的服务器看了下价格，摸了摸自己的荷包，并且买了服务器还得去备案，麻烦~正愁着咋办，我突然想起，自己一年多用github+hexo搭建博客，不仅免费，而且不用去备案。于是开干，在网上参考了别人搭建github博客的文章，花了一天多的时间，搭建了该博客！ 二、展望1、博客 先定一个小目标，比如说。。。。。，想多了。。。。，坚持每周写一篇博客，不管是技术的还是其他的 2、go 本人是从事拍黄片工作的，感觉拍黄片能做的事还是比较局限，进来在学习golang，希望后面能发展成自己的主力语言 3、money 我博客取名叫lemon，其实是取得“来 money”的意思，简称lemon~要结婚、还贷、装修等等，到处是花钱的地方，所以要赶紧挣钱了。。。大家有网站开发类的私活可以找我哈~","tags":[{"name":"随笔","slug":"随笔","permalink":"http://yoursite.com/tags/随笔/"}]},{"title":"Github+Hexo搭建博客","date":"2017-10-05T08:30:44.000Z","path":"2017/10/05/Github-Hexo搭建博客/","text":"一、环境搭建1.NodeJS 安装NodeJS：http://nodejs.cn/download/ 下载.msi文件，不需要配置环境变量 2.github 安装git ssh工具：https://git-for-windows.github.io/ 配置git环境，推荐教程：https://www.liaoxuefeng.com 3.hexo 安装Hexo: npm install -g hexo 初始化Hexo: hexo init 生成静态页面：hexo generate 或者 hexo g 启动服务器：hexo server 或者 hexo s 浏览器中访问：http://localhost:4000 二、更换主题及主题配置1.更换主题 默认主题是landscape，在themes文件夹下，可以使用别人开发好的主题，这里有很多，我使用的是这一个: https://github.com/litten/hexo-theme-yilia下载之后放到themes文件夹下即可：git clone git@github.com:litten/hexo-theme-yilia.git 2.主题基本配置 注意，主题配置修改的都是themes/yilia/_config.yml，配置项不一一解释了 3.头像和打赏配置（1）图片的位置 图片应该放在当前博客下面，比如我建了一个img文件夹，图片就放在里面，如下图所示： （2）具体配置 1234567891011#打赏# 打赏type设定：0-关闭打赏； 1-文章对应的md文件里有reward:true属性，才有打赏； 2-所有文章均有打赏reward_type: 2# 打赏wordingreward_wording: &apos;谢谢你请我吃糖果&apos;# 支付宝二维码图片地址，跟你设置头像的方式一样。比如：/assets/img/alipay.jpgalipay: /img/alipay.png# 微信二维码图片地址weixin: /img/wepay.png# 头像地址avatar: /img/avatar.jpg ​ 三、博客的基本配置 注意：这里修改的都是最外层的_config.yml（不是themes文件夹里面） 1.所有文章 在_config.yml中配置如下，不加的话，点击所有文章会报错 123456789101112131415161718jsonContent: meta: false pages: false posts: title: true date: true path: true text: true raw: false content: false slug: false updated: false comments: false link: false permalink: false excerpt: false categories: false tags: true 2.部署配置 配置到github对应的仓库中 在_config.yml中配置如下： 1234deploy: type: git repo: git@github.com:username/username.github.io.git branch: master 四、高级功能配置1、网站访问量显示（1）效果 （2） 实现 使用了不蒜子第三方的统计插件，网址：http://ibruce.info/2015/04/04/busuanzi/ 在themes\\yilia\\layout_partial下的footer.ejs中加入如下代码即可，如下所示： 12345678910111213141516171819202122&lt;footer id=&quot;footer&quot;&gt; &lt;div class=&quot;outer&quot;&gt; &lt;div id=&quot;footer-info&quot;&gt; &lt;div class=&quot;footer-left&quot;&gt; &amp;copy; &lt;%= date(new Date(), &apos;YYYY&apos;) %&gt; &lt;%= config.author || config.title %&gt; &lt;/div&gt; &lt;div&gt; &lt;span id=&quot;busuanzi_container_site_pv&quot;&gt; 本站总访问量&lt;span id=&quot;busuanzi_value_site_pv&quot;&gt;&lt;/span&gt;次 &lt;/span&gt; &lt;span id=&quot;busuanzi_container_site_uv&quot;&gt; 总访客数&lt;span id=&quot;busuanzi_value_site_uv&quot;&gt;&lt;/span&gt;人次 &lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;footer-right&quot;&gt; &lt;a href=&quot;http://hexo.io/&quot; target=&quot;_blank&quot;&gt;Hexo&lt;/a&gt; Theme &lt;a href=&quot;https://github.com/litten/hexo-theme-yilia&quot; target=&quot;_blank&quot;&gt;Yilia&lt;/a&gt; by Litten &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/footer&gt;&lt;script async src=&quot;//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js&quot;&gt;&lt;/script&gt; 2、评论功能（1）效果 （2）实现 去来必力网站注册账号，https://livere.com/ 网站给的代码，如图 插入的代码需要调整下边距，不然下面的第三方登录按钮会被覆盖导致错位，我加的代码如下 1style=&quot;margin: 0 50px 0 50px&quot; 最后在themes\\yilia\\layout_partial下的article.ejs将改代码添加到&lt;% if (theme.wangyiyun){ %&gt;前面 12345678910111213141516171819202122232425&lt;!-- 来必力City版安装代码 --&gt; &lt;div id=&quot;lv-container&quot; data-id=&quot;city&quot; data-uid=&quot;MTAyMC8zMTIwOS83NzU4&quot; style=&quot;margin: 0 50px 0 50px&quot;&gt; &lt;script type=&quot;text/javascript&quot;&gt; (function(d, s) &#123; var j, e = d.getElementsByTagName(s)[0]; if (typeof LivereTower === &apos;function&apos;) &#123; return; &#125; j = d.createElement(s); j.src = &apos;https://cdn-city.livere.com/js/embed.dist.js&apos;; j.async = true; e.parentNode.insertBefore(j, e); &#125;)(document, &apos;script&apos;); &lt;/script&gt; &lt;noscript&gt; 为正常使用来必力评论功能请激活JavaScript&lt;/noscript&gt; &lt;/div&gt; &lt;!-- City版安装代码已完成 --&gt; &lt;% if (theme.wangyiyun)&#123; %&gt; &lt;%- partial(&apos;post/wangyiyun&apos;, &#123; key: post.slug, title: post.title, url: config.url+url_for(post.path) &#125;) %&gt; &lt;% &#125; %&gt; 五、域名绑定1、申请域名 本人是在阿里云上面申请的域名，注意.com域名不需要备案，.cn是国内域名，需要备案 2、域名解析 ping username.github.io，来获取你的空间的ip 添加CNAME类型的解析 添加结果如图： 3、配置到github 在博客的根目录下新建一个CNAME文件 填写申请的域名，xxx.com push到github即可 六、感谢 本文参考了Lawlite的：Hexo+Github搭建自己的博客并按照步骤一步步搭建，几个模块的搭建方法有些许不同，在Lawlite的基础上做了修改，编写了这篇博客！","tags":[{"name":"github","slug":"github","permalink":"http://yoursite.com/tags/github/"},{"name":"hexo","slug":"hexo","permalink":"http://yoursite.com/tags/hexo/"}]},{"title":"Hello World","date":"2017-10-05T08:00:03.681Z","path":"2017/10/05/hello-world/","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","tags":[]}]